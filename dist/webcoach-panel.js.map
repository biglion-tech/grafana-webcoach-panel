{"version":3,"sources":["../src/webcoach-panel.js"],"names":["MetricsPanelCtrl","_","WebcoachAdviceListPanelCtrl","$scope","$injector","defaultsDeep","panel","bgColor","scrollable","adviceList","viewAdviceList","events","on","onInitEditMode","bind","onPanelTeardown","render","onDataReceived","addEditorTab","dataList","length","jsonString","datapoints","JSON","parse","adviceMap","key","push","setViewAdviceList","console","log","$timeout","cancel","nextTickPromise","type","filter","advice","Score","event","target","closest","classList","toggle","scope","elem","$panelContainer","find","css","templateUrl"],"mappings":"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","file":"webcoach-panel.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport './css/webcoach-panel.css!';\n\n\n\nexport class WebcoachAdviceListPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    _.defaultsDeep(this.panel, {\n      bgColor: null,\n      scrollable: true\n    });\n    this.scrollable = true;\n    this.adviceList = [];\n    this.viewAdviceList = [];\n    // this.filtered\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/webcoach-panel/editor.html', 2);\n  }\n\n  setViewAdviceList(adviceList = []) {\n    this.viewAdviceList = adviceList\n  }\n\n  onDataReceived(dataList) {\n    if (dataList.length > 0) {\n      let jsonString = dataList[0].datapoints[0][0],\n        adviceList = JSON.parse(jsonString),\n        adviceMap = [];\n      \n      for(let key in adviceList) {\n        adviceMap.push(adviceList[key])\n      }\n\n      this.adviceList = adviceMap;\n      this.setViewAdviceList(adviceList)\n      this.render();\n\n      console.log('adviceList', adviceList)\n    }\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n\n  onClickFilter(type = 'all') {\n    this.viewAdviceList = this.adviceList.filter(function (advice){\n      switch(type) {\n        case \"fail\": \n          return advice.Score < 30;\n          break;\n        case \"medium\": \n          return advice.Score > 30 && advice.Score < 80;\n          break;\n        case \"success\": \n          return advice.Score > 80;\n          break;\n        default:\n          return this.adviceList\n          break;\n      }\n    }); \n  }\n\n  onClickListItemTitle(event) {\n    console.log('event', event);\n    event.target.closest('.webcoach-panel__list_item').classList.toggle('-collapsed');\n  }\n\n  link(scope, elem) {\n    this.events.on('render', () => {\n      const $panelContainer = elem.find('.panel-container');\n\n      if (this.panel.bgColor) {\n        $panelContainer.css('background-color', this.panel.bgColor);\n      } else {\n        $panelContainer.css('background-color', '');\n      }\n    });\n  }\n}\n\nWebcoachAdviceListPanelCtrl.templateUrl = 'module.html';\n"]}