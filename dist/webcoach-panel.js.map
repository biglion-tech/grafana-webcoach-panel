{"version":3,"sources":["../src/webcoach-panel.js"],"names":["MetricsPanelCtrl","_","WebcoachAdviceListPanelCtrl","$scope","$injector","defaultsDeep","panel","bgColor","scrollable","adviceList","viewAdviceList","events","on","onInitEditMode","bind","onPanelTeardown","render","onDataReceived","addEditorTab","dataList","length","jsonString","datapoints","JSON","parse","adviceMap","key","push","setViewAdviceList","type","filter","advice","Score","event","target","closest","classList","toggle","scope","elem","$panelContainer","find","css","templateUrl"],"mappings":"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","file":"webcoach-panel.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport './css/webcoach-panel.css!';\n\nexport class WebcoachAdviceListPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    _.defaultsDeep(this.panel, {\n      bgColor: null\n    });\n\n    this.scrollable = true;\n    /**\n     * @property {array} adviceList - full advices list\n     */\n    this.adviceList = [];\n    /**\n     * @property {array} viewAdviceList - filtered advices for view\n     */\n    this.viewAdviceList = [];\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/webcoach-panel/editor.html', 2);\n  }\n\n  setViewAdviceList(adviceList = []) {\n    this.viewAdviceList = adviceList\n  }\n  /**\n   * Parse json string to object and convert to array\n   * @param {object} dataList object after json.parse advice list\n   */\n  onDataReceived(dataList) {\n    if (dataList.length > 0) {\n      let jsonString = dataList[0].datapoints[0][0],\n        adviceList = JSON.parse(jsonString),\n        adviceMap = [];\n      \n      for(let key in adviceList) {\n        adviceMap.push(adviceList[key])\n      }\n\n      this.adviceList = adviceMap;\n      this.setViewAdviceList(adviceList)\n      this.render();\n    }\n  }\n\n  onClickFilter(type = 'all') {\n    this.viewAdviceList = this.adviceList.filter(function (advice){\n      switch(type) {\n        case \"fail\": \n          return advice.Score < 30;\n          break;\n        case \"medium\": \n          return advice.Score > 30 && advice.Score < 80;\n          break;\n        case \"success\": \n          return advice.Score > 80;\n          break;\n        default:\n          return true\n          break;\n      }\n    }); \n  }\n\n  onClickListItemTitle(event) {\n    event.target.closest('.webcoach-panel__list_item').classList.toggle('-collapsed');\n  }\n\n  link(scope, elem) {\n    this.events.on('render', () => {\n      const $panelContainer = elem.find('.panel-container');\n\n      if (this.panel.bgColor) {\n        $panelContainer.css('background-color', this.panel.bgColor);\n      } else {\n        $panelContainer.css('background-color', '');\n      }\n    });\n  }\n}\n\nWebcoachAdviceListPanelCtrl.templateUrl = 'module.html';\n"]}